#!/bin/sh

OPTFILE="_CoqProject"

if [ "$#" -ne 0 ];
then
    >&2 echo "$0 does not understand arguments.
Use environment variables instead: hoqc, hoqtop and hoqdep should be in your PATH or in HOQDIR.";
    exit 1;
fi

if [ -z "${HOQDIR}" ]
then if which hoqc > /dev/null && which hoqtop > /dev/null && which hoqdep > /dev/null;
     then
         HOQC=$(which hoqc);
         HOQTOP=$(which hoqtop);
         HOQDEP=$(which hoqdep);
     else
         >&2 echo "HOQDIR not set and hoqc, hoqtop or hoqdep not in path"
         exit 1
     fi
else
    # if HOQDIR is set do not check that it's full
    HOQC="$HOQDIR/hoqc";
    HOQTOP="$HOQDIR/hoqtop";
    HOQDEP="$HOQDIR/hoqdep";
fi

cp "$OPTFILE.in" "$OPTFILE"

echo "COQC = $HOQC" >> "$OPTFILE"
echo "COQDEP = $HOQDEP" >> "$OPTFILE"

find . -name '*.v' >> "$OPTFILE"

coq_makefile -f "$OPTFILE" -o Makefile

echo "((coq-mode . ((coq-prog-name . \"$HOQTOP\"))))" > .dir-locals.el
